---
# Ansible managed
version: "3.1"
services:
  postgres:
    image: postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: keycloak
      POSTGRES_USER: keycloak
      POSTGRES_PASSWORD: password

  keycloak:
    #image: "nicolasvandooren/keycloakmedirad:1.0.1"
    image: mykeycloak:latest
    container_name: mykeycloak
    ports:
      - "8880:8080"
      - "8843:8443"
      - "8990:8990"
    env_file: docker-compose.env
    environment:
      - KEYCLOAK_HTTP_PORT=8880
      - KEYCLOAK_HTTPS_PORT=8843
      - MANAGEMENT_HTTP_PORT=8990
      - DB_VENDOR=POSTGRES
      - DB_ADDR=postgres
      - DB_DATABASE=keycloak
      - DB_USER=keycloak
      - DB_PASSWORD=password
    depends_on:
      - postgres
    volumes:
      - keycloak-standalone:/opt/keycloak/standalone
    logging:
      driver: json-file
      options:
        max-size: "10m"
    secrets:
      - users_lists
      - db_password

secrets:
  users_password:
    file: secrets/users_password
  users_lists:
    file: secrets/users_lists
  db_password:
    file: secrets/db_password

volumes:
  keycloak-standalone:
  postgres_data:

networks:
  default:
    external:
      name: medirad
